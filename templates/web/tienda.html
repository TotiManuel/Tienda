{% extends 'base.html' %}

{% block title %}Tienda{% endblock %}

{% block content %}

<h2>Tienda</h2>
<p>Explora todos nuestros productos disponibles</p>

<!-- ====== FILTRO POR CATEGORÍA ====== -->
{% if categorias %}
<div style="margin-bottom:1.5rem;">
    <strong>Filtrar por categoría:</strong>
    {% for categoria in categorias %}
        <a href="{{ url_for('web.tienda', categoria=categoria) }}"
           class="btn"
           style="margin:0.25rem;">
            {{ categoria }}
        </a>
    {% endfor %}
</div>
{% endif %}

<!-- ====== LISTADO DE PRODUCTOS ====== -->
<div class="cards-container" style="display:flex; flex-wrap:wrap; gap:1rem;">
{% for producto in productos %}
    <div class="card" style="flex:1 1 220px; padding:1rem;">
        <img src="{{ url_for('static', filename=producto.imagen) }}"
             alt="{{ producto.nombre }}"
             style="width:100%; border-radius:8px;">

        <h3>{{ producto.nombre }}</h3>
        <p>{{ producto.descripcion }}</p>
        <p><strong>${{ '%.2f' | format(producto.precio) }}</strong></p>

        {% if producto.stock > 0 %}
        <form method="POST"
            action="{{ url_for('web.agregar_carrito', producto_id=producto.id) }}">
            <input type="number"
                name="cantidad"
                value="1"
                min="1"
                max="{{ producto.stock }}"
                style="width:60px;">
            <button type="submit" class="btn">
                Agregar al carrito
            </button>
        </form>

        <small>Stock disponible: {{ producto.stock }}</small>
        {% else %}
        <p style="color:red;"><strong>Sin stock</strong></p>
        {% endif %}
    </div>
{% else %}
    <p>No hay productos disponibles.</p>
{% endfor %}
</div>

{% endblock %}

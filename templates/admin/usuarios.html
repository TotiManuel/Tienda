{% extends 'base.html' %}

{% block title %}Usuarios{% endblock %}

{% block content %}
<h2>Usuarios</h2>

<!-- Formulario para agregar usuario -->
<h3>Agregar Usuario</h3>
<form method="POST" action="{{ url_for('admin.agregar_usuario') }}">
    <input type="text" name="nombre" placeholder="Nombre" required>
    <input type="password" name="password" placeholder="Contraseña" required>
    <select name="rol" required>
        <option value="admin">Admin</option>
        <option value="vendedor">Vendedor</option>
        <option value="cliente">Cliente</option>
    </select>
    <button type="submit">Agregar</button>
</form>

<hr>

<!-- Tabla de usuarios -->
<h3>Usuarios existentes</h3>
<input
    type="text"
    id="buscadorUsuarios"
    placeholder="Buscar por nombre o rol..."
    style="margin-bottom:10px; padding:5px; width:300px;"
>
<table border="1" cellpadding="5">
    <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Rol</th>
        <th>Acciones</th>
    </tr>
    {% for user in usuarios %}
    <tr>
        <td>{{ user.id }}</td>
        <td>{{ user.nombre }}</td>
        <td>{{ user.rol }}</td>
        <td>
            <!-- Formulario editar inline -->
            <form method="POST" action="{{ url_for('admin.editar_usuario', user_id=user.id) }}" style="display:inline;">
                <input type="text" name="nombre" value="{{ user.nombre }}" required>
                <select name="rol" required>
                    <option value="admin" {% if user.rol=='admin' %}selected{% endif %}>Admin</option>
                    <option value="vendedor" {% if user.rol=='vendedor' %}selected{% endif %}>Vendedor</option>
                    <option value="cliente" {% if user.rol=='cliente' %}selected{% endif %}>Cliente</option>
                </select>
                <input type="password" name="password" placeholder="Nueva contraseña">
                <button type="submit">Guardar</button>
            </form>

            <!-- Eliminar -->
            <form method="POST" action="{{ url_for('admin.eliminar_usuario', user_id=user.id) }}" style="display:inline;">
                <button type="submit" onclick="return confirm('¿Seguro que deseas eliminar este usuario?');">Eliminar</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const buscador = document.getElementById("buscadorUsuarios");

    buscador.addEventListener("keyup", function () {
        const filtro = this.value.toLowerCase();
        const filas = document.querySelectorAll("table tr");

        filas.forEach((fila, index) => {
            if (index === 0) return; // encabezado

            const nombre = fila.children[1].innerText.toLowerCase();
            const rol = fila.children[2].innerText.toLowerCase();

            const coincide = nombre.includes(filtro) || rol.includes(filtro);
            fila.style.display = coincide ? "" : "none";
        });
    });
});
</script>

{% endblock %}

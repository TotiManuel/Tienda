<link rel="stylesheet" href="{{ url_for('static', filename='css/clientes.css') }}">

<div class="clientes-container">

    <h2>üë• Clientes</h2>

    <!-- Estad√≠sticas -->
    <div class="clientes-stats">
        <div class="stat">
            <h4>Total clientes</h4>
            <p>{{ clientes|length }}</p>
        </div>

        <div class="stat">
            <h4>Total deuda</h4>
            <p>${{ total_deuda }}</p>
        </div>

        <div class="stat">
            <h4>Morosos</h4>
            <p>{{ clientes_morosos|length }}</p>
        </div>
    </div>


    <!-- Buscador -->
    <input id="buscador" placeholder="Buscar cliente..." class="buscador">


    <!-- Form crear -->
    <form method="POST" action="/clientes/crear" class="form-cliente">
        <input name="nombre" placeholder="Nombre" required>
        <input name="telefono" placeholder="WhatsApp">
        <input name="email" placeholder="Email">
        <input name="direccion" placeholder="Direcci√≥n">
        <button>Guardar</button>
    </form>

    <hr>

    <!-- Morosos -->
    <h3>‚ö†Ô∏è Clientes morosos</h3>
    <div class="lista-morosos">
        {% for c in clientes_morosos %}
        <div class="moroso">
            <span>{{ c.nombre }}</span>
            <strong>${{ c.saldo_deuda }}</strong>
        </div>
        {% endfor %}
    </div>


    <!-- Ranking -->
    <h3>üèÜ Mejores clientes</h3>
    <div class="ranking">
        {% for r in ranking %}
        <div class="ranking-item">
            <span>{{ r[0] }}</span>
            <strong>${{ r[1] }}</strong>
        </div>
        {% endfor %}
    </div>

    <hr>

    <!-- Lista clientes -->
    <div class="clientes-grid" id="lista-clientes">
        {% for c in clientes %}
        <div class="card-cliente">

            <div class="cliente-header">
                <h3>{{ c.nombre }}</h3>

                {% if c.saldo_deuda == 0 %}
                <span class="estado ok">OK</span>
                {% elif c.saldo_deuda > 50000 %}
                <span class="estado alto">ALTO</span>
                {% else %}
                <span class="estado medio">MEDIO</span>
                {% endif %}
            </div>

            <p>{{ c.telefono }}</p>
            <p>Deuda: <strong>${{ c.saldo_deuda }}</strong></p>

            <div class="acciones">

                <a href="/clientes/{{ c.id }}" class="btn ver">
                    Historial
                </a>

                <a target="_blank" 
                   href="https://wa.me/549{{ c.telefono }}" 
                   class="btn whatsapp">
                   WhatsApp
                </a>

            </div>

        </div>
        {% endfor %}
    </div>

</div>


<script>
const buscador = document.getElementById("buscador");
const clientes = document.querySelectorAll(".card-cliente");

buscador.addEventListener("keyup", function(){
    let texto = this.value.toLowerCase();

    clientes.forEach(c => {
        let nombre = c.querySelector("h3").innerText.toLowerCase();

        if(nombre.includes(texto)){
            c.style.display = "block";
        }else{
            c.style.display = "none";
        }
    });
});
</script>
